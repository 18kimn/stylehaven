<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="stylehaven">
<title>Example plot walkthrough • stylehaven</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><link href="../deps/_Open%20Sans-0.4.0/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example plot walkthrough">
<meta property="og:description" content="stylehaven">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">stylehaven</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/dcws_example_plots.html">Plot examples from the DCWS launch</a>
    <a class="dropdown-item" href="../articles/plot_walkthrough.html">Example plot walkthrough</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/CT-Data-Haven/stylehaven/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">

<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Example plot walkthrough</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/CT-Data-Haven/stylehaven/blob/HEAD/vignettes/plot_walkthrough.Rmd" class="external-link"><code>vignettes/plot_walkthrough.Rmd</code></a></small>
      <div class="d-none name"><code>plot_walkthrough.Rmd</code></div>
    </div>

    
    
<div class="section level1">
<h1 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h1>
<p>This is a walkthrough of some of the considerations in making charts, and some of the ways DataHaven’s budding code infrastructure can help build and style charts that are simple and easy to read. I’ll be using some example datasets that I built into the { stylehaven } package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/slowkow/ggrepel" class="external-link">ggrepel</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/yixuan/showtext" class="external-link">showtext</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/CT-Data-Haven/stylehaven" class="external-link">stylehaven</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">flipbookr</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/showtext/man/showtext_auto.html" class="external-link">showtext_auto</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/sysfonts/man/font_add_google.html" class="external-link">font_add_google</a></span><span class="op">(</span><span class="st">"Barlow Semi Condensed"</span>, bold.wt <span class="op">=</span> <span class="fl">600</span><span class="op">)</span></code></pre></div>
<hr>
</div>
<div class="section level1">
<h1 id="color">Color<a class="anchor" aria-label="anchor" href="#color"></a>
</h1>
<p>I’m using the yellow-green-blue palette from ColorBrewer for sequential data. Sequential palettes are hard to get right—there’s a bunch of psychological research that went into the ColorBrewer palettes—so I’ll organize other colors around that. For charts with only one color of bars, etc., I’ll use one of the medium to dark shades from that palette. For qualitative data I’ll try to find a set of colors that work together across multiple hues based around that main color. The function <code><a href="../reference/palx.html">stylehaven::palx</a></code> ports a Javascript library for this.</p>
<hr>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">seq_pal</span> <span class="op">&lt;-</span> <span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span><span class="fl">7</span>, <span class="st">"YlGnBu"</span><span class="op">)</span>
<span class="fu">camiller</span><span class="fu">::</span><span class="fu"><a href="https://camille-s.github.io/camiller/reference/color_prev.html" class="external-link">color_prev</a></span><span class="op">(</span><span class="va">seq_pal</span><span class="op">)</span></code></pre></div>
<p><img src="plot_walkthrough_files/figure-html/palx1-1.png" width="700"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">primary</span> <span class="op">&lt;-</span> <span class="va">seq_pal</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span></code></pre></div>
<hr>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">palx_colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/palx.html">palx</a></span><span class="op">(</span><span class="va">primary</span>, n <span class="op">=</span> <span class="fl">9</span>, n_shades <span class="op">=</span> <span class="fl">5</span>, plot <span class="op">=</span> <span class="cn">TRUE</span>, labels <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="plot_walkthrough_files/figure-html/unnamed-chunk-1-1.png" width="672"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">qual_pal</span> <span class="op">&lt;-</span> <span class="va">palx_colors</span><span class="op">[[</span><span class="st">"shade04"</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<hr>
<p>These are obviously not finished charts, just an example to see how the colors look pretty nice between the two charts, so it’s a good way to find colors that work well within one document or project.</p>
<p>.pull-left[]</p>
<p>.pull-right[]</p>
<hr>
</div>
<div class="section level1">
<h1 id="a-very-simple-bar-chart">A very simple bar chart<a class="anchor" aria-label="anchor" href="#a-very-simple-bar-chart"></a>
</h1>
<p>Bar charts are really boring. Here are some reasons why that’s great:</p>
<ul>
<li>People are familiar with them, and as much as non-data people know how to read a chart, they probably know how to read a bar chart.</li>
<li>They provide a very neat data-to-ink mapping where all you need to read is the length of a bar.</li>
<li>They have natural places to add things like value labels and other annotations.</li>
<li>They can be spruced up in lots of ways and still stay legible.</li>
<li>They can be enhanced by interactivity, but don’t require it.</li>
</ul>
<hr>
<p>The data I’m using here is <code><a href="../reference/rent_x_income.html">stylehaven::rent_x_income</a></code>, which gives the median household income of renting households and the annual median rent for all rented housing units and for 2 bedroom units for every (most?) town in New Haven County. There’s also a column I calculated of the income at which that median rent would be affordable under HUD guidelines (where affordable housing costs no more than 30 percent of a household’s total income).</p>
<p>This is from the 2019 ACS 5-year estimates, and is an updated version of data used in the 2019 Community Index.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>rent_2br <span class="ot">&lt;-</span> stylehaven<span class="sc">::</span>rent_x_income <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(bedrooms <span class="sc">==</span> <span class="st">"2br"</span>, renters <span class="sc">&gt;=</span> <span class="dv">1500</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(rent_2br)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;246m<span class="co"># A tibble: 6 × 6 [39m</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  name      bedrooms renters income annual_rent income_needed</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>   [3m [<span class="dv">38</span>;<span class="dv">5</span>;246m<span class="sc">&lt;</span>chr<span class="sc">&gt;</span> [39m [23m      [3m [<span class="dv">38</span>;<span class="dv">5</span>;246m<span class="sc">&lt;</span>fct<span class="sc">&gt;</span> [39m [23m       [3m [<span class="dv">38</span>;<span class="dv">5</span>;246m<span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> [39m [23m   [3m [<span class="dv">38</span>;<span class="dv">5</span>;246m<span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> [39m [23m        [3m [<span class="dv">38</span>;<span class="dv">5</span>;246m<span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> [39m [23m          [3m [<span class="dv">38</span>;<span class="dv">5</span>;246m<span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> [39m [23m</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;250m1 [39m Ansonia   2br          [4m1 [24m527   [4m3 [24m [4m2 [24m407        [4m1 [24m [4m3 [24m572          [4m4 [24m [4m5 [24m240</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;250m2 [39m Branford  2br          [4m1 [24m813   [4m5 [24m [4m0 [24m765        [4m1 [24m [4m7 [24m616          [4m5 [24m [4m8 [24m720</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;250m3 [39m Hamden    2br          [4m3 [24m287   [4m4 [24m [4m9 [24m863        [4m1 [24m [4m8 [24m768          [4m6 [24m [4m2 [24m560</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;250m4 [39m Meriden   2br          [4m3 [24m896   [4m4 [24m [4m0 [24m938        [4m1 [24m [4m3 [24m308          [4m4 [24m [4m4 [24m360</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;250m5 [39m Milford   2br          [4m2 [24m189   [4m6 [24m [4m4 [24m020        [4m2 [24m [4m0 [24m040          [4m6 [24m [4m6 [24m800</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;250m6 [39m Naugatuck 2br          [4m1 [24m650   [4m3 [24m [4m8 [24m942        [4m1 [24m [4m3 [24m428          [4m4 [24m [4m4 [24m760</span></code></pre></div>
<hr>
<p>A super simple but ugly chart of annualized median rents would be like this:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rent_2br</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">name</span>, y <span class="op">=</span> <span class="va">annual_rent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="plot_walkthrough_files/figure-html/bar-static-1.png" width="576"></p>
<hr>
<p>I’ll build on that in a handful of ways:</p>
<ul>
<li>Labels are overlapping—flip to lay bars out horizontally</li>
<li>Bar order is arbitrary (alphabetical)—make a factor and reorder by value</li>
<li>Bars are a little too thick, and could use a better color</li>
</ul>
<hr>
<p>count: false</p>
<p>.panel1-bar-flip-auto[]</p>
<p>.panel2-bar-flip-auto[]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<thead><tr class="header">
<th align="left">count: false</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">count: false</td>
</tr>
<tr class="even">
<td align="left">.panel1-bar-flip-auto[</td>
</tr>
<tr class="odd">
<td align="left">
<code>r rent_2br %&gt;% mutate(name = forcats::as_factor(name) %&gt;% forcats::fct_reorder(annual_rent)) %&gt;% ggplot(aes(x = name, y = annual_rent))   #&lt;&lt;</code> ]</td>
</tr>
<tr class="even">
<td align="left">.panel2-bar-flip-auto[ <img src="plot_walkthrough_files/figure-html/bar-flip_auto_03_output-1.png" width="700">]</td>
</tr>
</tbody>
</table>
<p>count: false</p>
<p>.panel1-bar-flip-auto[]</p>
<p>.panel2-bar-flip-auto[ <img src="plot_walkthrough_files/figure-html/bar-flip_auto_04_output-1.png" width="700">]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<tbody>
<tr class="odd">
<td>count: false</td>
</tr>
<tr class="even">
<td>.panel1-bar-flip-auto[</td>
</tr>
<tr class="odd">
<td>
<code>r rent_2br %&gt;% mutate(name = forcats::as_factor(name) %&gt;% forcats::fct_reorder(annual_rent)) %&gt;% ggplot(aes(x = name, y = annual_rent)) + geom_col(width = 0.8, fill = primary) + coord_flip()  #&lt;&lt;</code> ]</td>
</tr>
<tr class="even">
<td>.panel2-bar-flip-auto[ <img src="plot_walkthrough_files/figure-html/bar-flip_auto_05_output-1.png" width="700">]</td>
</tr>
<tr class="odd">
<td></td>
</tr>
</tbody>
</table>
<p>Now it’s legible and nicer to look at, but there are still some things that are inefficient:</p>
<ul>
<li>We can get a rough read of the values, but for a quick takeaway it would be better to just put labels directly on the bars
<ul>
<li>Labels don’t need to be exact—they can (and should) just be rounded off &amp; abbreviated</li>
<li>Labels should be within the bars whenever possible; otherwise, you risk implying larger values than are in the data. Use <code>stylehaven::offset_lbl</code> to help deal with offsetting 0 or N/A values</li>
</ul>
</li>
<li>
<a href="https://infovis-wiki.net/wiki/Data-Ink_Ratio" class="external-link">The data-to-ink ratio</a> still isn’t great. Instead of independent-axis ticks, just remove padding between the town names and bars</li>
<li>Once the values are labeled, the dependent-axis becomes redundant, as do the grid lines</li>
<li>Once the gridlines are removed, the background fill is unnecessary</li>
</ul>
<hr>
<p>count: false</p>
<div class="section level2">
<h2 id="direct-labeling">Direct labeling<a class="anchor" aria-label="anchor" href="#direct-labeling"></a>
</h2>
<p>.panel1-bar-txt-rotate[]</p>
<p>.panel2-bar-txt-rotate[ <img src="plot_walkthrough_files/figure-html/bar-txt_rotate_01_output-1.png" width="700">]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<thead><tr class="header">
<th align="left">count: false</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">count: false</td>
</tr>
<tr class="even">
<td align="left">## Direct labeling .panel1-bar-txt-rotate[</td>
</tr>
<tr class="odd">
<td align="left">
<code>r rent_2br %&gt;% mutate(name = forcats::as_factor(name) %&gt;% forcats::fct_reorder(annual_rent)) %&gt;% mutate(lbl = scales::dollar(annual_rent, accuracy = 1, scale = 1 / 1000, suffix = "k")) %&gt;% ggplot(aes(x = name, y = annual_rent)) + geom_col(width = 0.8, fill = primary) + coord_flip() + geom_text(aes(label = lbl), hjust = 1)   #&lt;&lt;</code> ]</td>
</tr>
<tr class="even">
<td align="left">.panel2-bar-txt-rotate[ <img src="plot_walkthrough_files/figure-html/bar-txt_rotate_03_output-1.png" width="700">]</td>
</tr>
</tbody>
</table>
<p>count: false</p>
</div>
<div class="section level2">
<h2 id="direct-labeling-1">Direct labeling<a class="anchor" aria-label="anchor" href="#direct-labeling-1"></a>
</h2>
<p>.panel1-bar-txt-rotate[]</p>
<p>.panel2-bar-txt-rotate[ <img src="plot_walkthrough_files/figure-html/bar-txt_rotate_04_output-1.png" width="700">]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<thead><tr class="header">
<th align="left">count: false</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">count: false</td>
</tr>
<tr class="even">
<td align="left">## Direct labeling .panel1-bar-txt-rotate[</td>
</tr>
<tr class="odd">
<td align="left">
<code>r rent_2br %&gt;% mutate(name = forcats::as_factor(name) %&gt;% forcats::fct_reorder(annual_rent)) %&gt;% mutate(lbl = scales::dollar(annual_rent, accuracy = 1, scale = 1 / 1000, suffix = "k")) %&gt;% ggplot(aes(x = name, y = annual_rent)) + geom_col(width = 0.8, fill = primary) + coord_flip() + geom_text(aes(label = lbl), nudge_y = -400, fontface = "bold", color = "white", hjust = 1)  #&lt;&lt;</code> ]</td>
</tr>
<tr class="even">
<td align="left">.panel2-bar-txt-rotate[ <img src="plot_walkthrough_files/figure-html/bar-txt_rotate_06_output-1.png" width="700">]</td>
</tr>
<tr class="odd">
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Note the use of <code>nudge_y</code> at the end—super handy, although it breaks when used with dodged positions. I’m building up an <code>offset_frac</code> function that will do something similar more robustly.</td>
</tr>
</tbody>
</table>
<p>count: false</p>
</div>
<div class="section level2">
<h2 id="theme-settings">Theme settings<a class="anchor" aria-label="anchor" href="#theme-settings"></a>
</h2>
<p>.panel1-bar-theme-user[]</p>
<p>.panel2-bar-theme-user[ <img src="plot_walkthrough_files/figure-html/bar-theme_user_01_output-1.png" width="700">]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<thead><tr class="header">
<th align="left">count: false</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">count: false</td>
</tr>
<tr class="even">
<td align="left">## Theme settings .panel1-bar-theme-user[</td>
</tr>
<tr class="odd">
<td align="left">
<code>r rent_2br %&gt;% mutate(name = forcats::as_factor(name) %&gt;% forcats::fct_reorder(annual_rent)) %&gt;% mutate(lbl = scales::dollar(annual_rent, accuracy = 1, scale = 1 / 1000, suffix = "k")) %&gt;% ggplot(aes(x = name, y = annual_rent)) + geom_col(width = 0.8, fill = primary) + geom_text(aes(label = lbl), nudge_y = -400, hjust = 1, fontface = "bold", color = "white", family = "Barlow Semi Condensed") + labs(title = "Placeholder title", subtitle = "Placeholder subtitle") + coord_flip() + scale_y_continuous(breaks = NULL, expand = expansion(mult = c(0, 0.05))) + theme(text = element_text(family = "Barlow Semi Condensed", size = 14))   #&lt;&lt;</code> ]</td>
</tr>
<tr class="even">
<td align="left">.panel2-bar-theme-user[ <img src="plot_walkthrough_files/figure-html/bar-theme_user_03_output-1.png" width="700">]</td>
</tr>
</tbody>
</table>
<p>count: false</p>
</div>
<div class="section level2">
<h2 id="theme-settings-1">Theme settings<a class="anchor" aria-label="anchor" href="#theme-settings-1"></a>
</h2>
<p>.panel1-bar-theme-user[]</p>
<p>.panel2-bar-theme-user[ <img src="plot_walkthrough_files/figure-html/bar-theme_user_04_output-1.png" width="700">]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<thead><tr class="header">
<th align="left">count: false</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">count: false</td>
</tr>
<tr class="even">
<td align="left">## Theme settings .panel1-bar-theme-user[</td>
</tr>
<tr class="odd">
<td align="left">
<code>r rent_2br %&gt;% mutate(name = forcats::as_factor(name) %&gt;% forcats::fct_reorder(annual_rent)) %&gt;% mutate(lbl = scales::dollar(annual_rent, accuracy = 1, scale = 1 / 1000, suffix = "k")) %&gt;% ggplot(aes(x = name, y = annual_rent)) + geom_col(width = 0.8, fill = primary) + geom_text(aes(label = lbl), nudge_y = -400, hjust = 1, fontface = "bold", color = "white", family = "Barlow Semi Condensed") + labs(title = "Placeholder title", subtitle = "Placeholder subtitle") + coord_flip() + scale_y_continuous(breaks = NULL, expand = expansion(mult = c(0, 0.05))) + theme(text = element_text(family = "Barlow Semi Condensed", size = 14)) + theme(panel.grid = element_blank()) + theme(panel.background = element_blank()) + theme(axis.ticks = element_blank())   #&lt;&lt;</code> ]</td>
</tr>
<tr class="even">
<td align="left">.panel2-bar-theme-user[ <img src="plot_walkthrough_files/figure-html/bar-theme_user_06_output-1.png" width="700">]</td>
</tr>
</tbody>
</table>
<p>count: false</p>
</div>
<div class="section level2">
<h2 id="theme-settings-2">Theme settings<a class="anchor" aria-label="anchor" href="#theme-settings-2"></a>
</h2>
<p>.panel1-bar-theme-user[]</p>
<p>.panel2-bar-theme-user[ <img src="plot_walkthrough_files/figure-html/bar-theme_user_07_output-1.png" width="700">]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<tbody>
<tr class="odd">
<td>count: false</td>
</tr>
<tr class="even">
<td>## Theme settings .panel1-bar-theme-user[</td>
</tr>
<tr class="odd">
<td>
<code>r rent_2br %&gt;% mutate(name = forcats::as_factor(name) %&gt;% forcats::fct_reorder(annual_rent)) %&gt;% mutate(lbl = scales::dollar(annual_rent, accuracy = 1, scale = 1 / 1000, suffix = "k")) %&gt;% ggplot(aes(x = name, y = annual_rent)) + geom_col(width = 0.8, fill = primary) + geom_text(aes(label = lbl), nudge_y = -400, hjust = 1, fontface = "bold", color = "white", family = "Barlow Semi Condensed") + labs(title = "Placeholder title", subtitle = "Placeholder subtitle") + coord_flip() + scale_y_continuous(breaks = NULL, expand = expansion(mult = c(0, 0.05))) + theme(text = element_text(family = "Barlow Semi Condensed", size = 14)) + theme(panel.grid = element_blank()) + theme(panel.background = element_blank()) + theme(axis.ticks = element_blank()) + theme(plot.title.position = "plot") + theme(plot.title = element_text(face = "bold"))  #&lt;&lt;</code> ]</td>
</tr>
<tr class="even">
<td>.panel2-bar-theme-user[ <img src="plot_walkthrough_files/figure-html/bar-theme_user_08_output-1.png" width="700">]</td>
</tr>
<tr class="odd">
<td></td>
</tr>
</tbody>
</table>
<p>I wouldn’t actually add a million <code>theme</code> calls like this, it’s just for illustration here. In fact, I’ll put them into a theme function and just use that from here on out.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">theme_clean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_gray</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Barlow Semi Condensed"</span>, size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>,
        panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        plot.title.position <span class="op">=</span> <span class="st">"plot"</span>,
        plot.caption.position <span class="op">=</span> <span class="st">"plot"</span>,
        plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,
        legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,
        legend.key.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">1.2</span>, <span class="st">"lines"</span><span class="op">)</span>,
        legend.key.height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="st">"lines"</span><span class="op">)</span>,
        legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1.5</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">0.4</span>, <span class="st">"lines"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Lastly, this needs better explanatory labels. In this case, I’ll remove the axis labels and put that same information in the subtitle.</p>
<hr>
<p>count: false</p>
</div>
<div class="section level2">
<h2 id="plot-labels">Plot labels<a class="anchor" aria-label="anchor" href="#plot-labels"></a>
</h2>
<p>.panel1-bar-labs-user[]</p>
<p>.panel2-bar-labs-user[ <img src="plot_walkthrough_files/figure-html/bar-labs_user_01_output-1.png" width="700">]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<thead><tr class="header">
<th align="left">count: false</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">count: false</td>
</tr>
<tr class="even">
<td align="left">## Plot labels .panel1-bar-labs-user[</td>
</tr>
<tr class="odd">
<td align="left">
<code>r rent_2br %&gt;% mutate(name = forcats::as_factor(name) %&gt;% forcats::fct_reorder(annual_rent)) %&gt;% mutate(lbl = scales::dollar(annual_rent, accuracy = 1, scale = 1 / 1000, suffix = "k")) %&gt;% ggplot(aes(x = name, y = annual_rent)) + geom_col(width = 0.8, fill = primary) + geom_text(aes(label = lbl), nudge_y = -400, hjust = 1, fontface = "bold", color = "white", family = "Barlow Semi Condensed") + coord_flip() + scale_y_continuous(breaks = NULL, expand = expansion(mult = c(0, 0.05))) + theme_clean() + labs(subtitle = "Annualized median rent for a 2-bedroom housing unit by town, 2019") + labs(x = NULL)   #&lt;&lt;</code> ]</td>
</tr>
<tr class="even">
<td align="left">.panel2-bar-labs-user[ <img src="plot_walkthrough_files/figure-html/bar-labs_user_03_output-1.png" width="700">]</td>
</tr>
</tbody>
</table>
<p>count: false</p>
</div>
<div class="section level2">
<h2 id="plot-labels-1">Plot labels<a class="anchor" aria-label="anchor" href="#plot-labels-1"></a>
</h2>
<p>.panel1-bar-labs-user[]</p>
<p>.panel2-bar-labs-user[ <img src="plot_walkthrough_files/figure-html/bar-labs_user_04_output-1.png" width="700">]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<thead><tr class="header">
<th align="left">count: false</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">count: false</td>
</tr>
<tr class="even">
<td align="left">## Plot labels .panel1-bar-labs-user[</td>
</tr>
<tr class="odd">
<td align="left">
<code>r rent_2br %&gt;% mutate(name = forcats::as_factor(name) %&gt;% forcats::fct_reorder(annual_rent)) %&gt;% mutate(lbl = scales::dollar(annual_rent, accuracy = 1, scale = 1 / 1000, suffix = "k")) %&gt;% ggplot(aes(x = name, y = annual_rent)) + geom_col(width = 0.8, fill = primary) + geom_text(aes(label = lbl), nudge_y = -400, hjust = 1, fontface = "bold", color = "white", family = "Barlow Semi Condensed") + coord_flip() + scale_y_continuous(breaks = NULL, expand = expansion(mult = c(0, 0.05))) + theme_clean() + labs(subtitle = "Annualized median rent for a 2-bedroom housing unit by town, 2019") + labs(x = NULL) + labs(y = NULL) + labs(title = "Rents vary widely across New Haven County") + labs(caption = "Source: US Census Bureau 2019 American Community Survey 5-year estimates")  #&lt;&lt;</code> ]</td>
</tr>
<tr class="even">
<td align="left">.panel2-bar-labs-user[ <img src="plot_walkthrough_files/figure-html/bar-labs_user_06_output-1.png" width="700">]</td>
</tr>
<tr class="odd">
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Pretty good!</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level1">
<h1 id="a-more-complicated-bar-chart">A more complicated bar chart<a class="anchor" aria-label="anchor" href="#a-more-complicated-bar-chart"></a>
</h1>
<p>Often we want to show DataHaven Community Wellbeing Survey data across several categories (age, gender, race, etc.). Formatting these is a bit more complicated.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>food_insecure <span class="ot">&lt;-</span> stylehaven<span class="sc">::</span>fin_insecurity <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">category =</span> forcats<span class="sc">::</span><span class="fu">fct_collapse</span>(category, <span class="at">Total =</span> <span class="fu">c</span>(<span class="st">"Connecticut"</span>, <span class="st">"Greater New Haven"</span>)),</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">value =</span> <span class="fu">round</span>(value, <span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(question <span class="sc">==</span> <span class="st">"food_insecurity"</span>, category <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Total"</span>, <span class="st">"Age"</span>, <span class="st">"Race/Ethnicity"</span>, <span class="st">"Children in home"</span>))</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(food_insecure)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;246m<span class="co"># A tibble: 6 × 4 [39m</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  question        category group             value</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>   [3m [<span class="dv">38</span>;<span class="dv">5</span>;246m<span class="sc">&lt;</span>chr<span class="sc">&gt;</span> [39m [23m            [3m [<span class="dv">38</span>;<span class="dv">5</span>;246m<span class="sc">&lt;</span>fct<span class="sc">&gt;</span> [39m [23m     [3m [<span class="dv">38</span>;<span class="dv">5</span>;246m<span class="sc">&lt;</span>fct<span class="sc">&gt;</span> [39m [23m              [3m [<span class="dv">38</span>;<span class="dv">5</span>;246m<span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> [39m [23m</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;250m1 [39m food_insecurity Total    Connecticut        <span class="fl">0.13</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;250m2 [39m food_insecurity Total    Greater New Haven  <span class="fl">0.13</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;250m3 [39m food_insecurity Age      Ages <span class="dv">18-34</span>         <span class="fl">0.18</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;250m4 [39m food_insecurity Age      Ages <span class="dv">35-49</span>         <span class="fl">0.2</span> </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;250m5 [39m food_insecurity Age      Ages <span class="dv">50-64</span>         <span class="fl">0.1</span> </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;250m6 [39m food_insecurity Age      Ages <span class="dv">65</span><span class="sc">+</span>           <span class="fl">0.05</span></span></code></pre></div>
<p>Instead of using <code>nudge_y</code> to pad the labels away from the ends of the bars, I’ll subtract a small value from each y placement. I’ll build on this to use <code>stylehaven::offset_lbl</code> later on.</p>
<hr>
<p>count: false</p>
<div class="section level2">
<h2 id="groups-part-1">Groups, part 1<a class="anchor" aria-label="anchor" href="#groups-part-1"></a>
</h2>
<p>.panel1-bar-groups-auto[]</p>
<p>.panel2-bar-groups-auto[]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<thead><tr class="header">
<th align="left">count: false</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">count: false</td>
</tr>
<tr class="even">
<td align="left">## Groups, part 1 .panel1-bar-groups-auto[</td>
</tr>
<tr class="odd">
<td align="left">```r food_bars &lt;- food_insecure %&gt;% ggplot(aes(x = forcats::fct_rev(group), y = value)) + geom_col(width = 0.8, fill = primary) #&lt;&lt;</td>
</tr>
<tr class="even">
<td align="left">food_bars ``` ]</td>
</tr>
<tr class="odd">
<td align="left">.panel2-bar-groups-auto[ <img src="plot_walkthrough_files/figure-html/bar-groups_auto_03_output-1.png" width="700">]</td>
</tr>
</tbody>
</table>
<p>count: false</p>
</div>
<div class="section level2">
<h2 id="groups-part-1-1">Groups, part 1<a class="anchor" aria-label="anchor" href="#groups-part-1-1"></a>
</h2>
<p>.panel1-bar-groups-auto[]</p>
<p>.panel2-bar-groups-auto[ <img src="plot_walkthrough_files/figure-html/bar-groups_auto_04_output-1.png" width="700">]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<thead><tr class="header">
<th align="left">count: false</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">count: false</td>
</tr>
<tr class="even">
<td align="left">## Groups, part 1 .panel1-bar-groups-auto[</td>
</tr>
<tr class="odd">
<td align="left">```r food_bars &lt;- food_insecure %&gt;% ggplot(aes(x = forcats::fct_rev(group), y = value)) + geom_col(width = 0.8, fill = primary) + coord_flip() + geom_text(aes(label = scales::percent(value, accuracy = 1), y = value - 5e-3), hjust = 1, color = “white”, fontface = “bold”, family = “Barlow Semi Condensed”) + scale_y_continuous(expand = expansion(mult = c(0, 0.05)), breaks = NULL) #&lt;&lt;</td>
</tr>
<tr class="even">
<td align="left">food_bars ``` ]</td>
</tr>
<tr class="odd">
<td align="left">.panel2-bar-groups-auto[ <img src="plot_walkthrough_files/figure-html/bar-groups_auto_06_output-1.png" width="700">]</td>
</tr>
</tbody>
</table>
<p>count: false</p>
</div>
<div class="section level2">
<h2 id="groups-part-1-2">Groups, part 1<a class="anchor" aria-label="anchor" href="#groups-part-1-2"></a>
</h2>
<p>.panel1-bar-groups-auto[]</p>
<p>.panel2-bar-groups-auto[ <img src="plot_walkthrough_files/figure-html/bar-groups_auto_07_output-1.png" width="700">]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<thead><tr class="header">
<th align="left">count: false</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">count: false</td>
</tr>
<tr class="even">
<td align="left">## Groups, part 1 .panel1-bar-groups-auto[</td>
</tr>
<tr class="odd">
<td align="left">```r food_bars &lt;- food_insecure %&gt;% ggplot(aes(x = forcats::fct_rev(group), y = value)) + geom_col(width = 0.8, fill = primary) + coord_flip() + geom_text(aes(label = scales::percent(value, accuracy = 1), y = value - 5e-3), hjust = 1, color = “white”, fontface = “bold”, family = “Barlow Semi Condensed”) + scale_y_continuous(expand = expansion(mult = c(0, 0.05)), breaks = NULL) + theme_clean() + labs(x = NULL, y = NULL) + labs(subtitle = “Share of adults by Greater New Haven demographic group, 2018”) #&lt;&lt;</td>
</tr>
<tr class="even">
<td align="left">food_bars ``` ]</td>
</tr>
<tr class="odd">
<td align="left">.panel2-bar-groups-auto[ <img src="plot_walkthrough_files/figure-html/bar-groups_auto_09_output-1.png" width="700">]</td>
</tr>
</tbody>
</table>
<p>count: false</p>
</div>
<div class="section level2">
<h2 id="groups-part-1-3">Groups, part 1<a class="anchor" aria-label="anchor" href="#groups-part-1-3"></a>
</h2>
<p>.panel1-bar-groups-auto[]</p>
<p>.panel2-bar-groups-auto[ <img src="plot_walkthrough_files/figure-html/bar-groups_auto_10_output-1.png" width="700">]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<tbody>
<tr class="odd">
<td>count: false</td>
</tr>
<tr class="even">
<td>## Groups, part 1 .panel1-bar-groups-auto[</td>
</tr>
<tr class="odd">
<td>```r food_bars &lt;- food_insecure %&gt;% ggplot(aes(x = forcats::fct_rev(group), y = value)) + geom_col(width = 0.8, fill = primary) + coord_flip() + geom_text(aes(label = scales::percent(value, accuracy = 1), y = value - 5e-3), hjust = 1, color = “white”, fontface = “bold”, family = “Barlow Semi Condensed”) + scale_y_continuous(expand = expansion(mult = c(0, 0.05)), breaks = NULL) + theme_clean() + labs(x = NULL, y = NULL) + labs(subtitle = “Share of adults by Greater New Haven demographic group, 2018”) + labs(title = “More than a third of Latino adults experience food insecurity”) + labs(caption = “Source: 2018 DataHaven Community Wellbeing Survey”) #&lt;&lt;</td>
</tr>
<tr class="even">
<td>food_bars ``` ]</td>
</tr>
<tr class="odd">
<td>.panel2-bar-groups-auto[ <img src="plot_walkthrough_files/figure-html/bar-groups_auto_11_output-1.png" width="700">]</td>
</tr>
<tr class="even">
<td></td>
</tr>
</tbody>
</table>
<p>count: false</p>
</div>
<div class="section level2">
<h2 id="groups-part-2">Groups, part 2<a class="anchor" aria-label="anchor" href="#groups-part-2"></a>
</h2>
<p>.panel1-bar-facet-rotate[]</p>
<p>.panel2-bar-facet-rotate[ <img src="plot_walkthrough_files/figure-html/bar-facet_rotate_01_output-1.png" width="700">]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<thead><tr class="header">
<th align="left">count: false</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">count: false</td>
</tr>
<tr class="even">
<td align="left">## Groups, part 2 .panel1-bar-facet-rotate[</td>
</tr>
<tr class="odd">
<td align="left">
<code>r food_bars + facet_grid(rows = vars(category), space = "free", scales = "free_y")   #&lt;&lt;</code> ]</td>
</tr>
<tr class="even">
<td align="left">.panel2-bar-facet-rotate[ <img src="plot_walkthrough_files/figure-html/bar-facet_rotate_03_output-1.png" width="700">]</td>
</tr>
</tbody>
</table>
<p>count: false</p>
</div>
<div class="section level2">
<h2 id="groups-part-2-1">Groups, part 2<a class="anchor" aria-label="anchor" href="#groups-part-2-1"></a>
</h2>
<p>.panel1-bar-facet-rotate[]</p>
<p>.panel2-bar-facet-rotate[ <img src="plot_walkthrough_files/figure-html/bar-facet_rotate_04_output-1.png" width="700">]</p>
<style>
.panel1-bar-facet-rotate {
  color: black;
  width: 58.8%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-bar-facet-rotate {
  color: black;
  width: 39.2%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-bar-facet-rotate {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
</style>
<hr>
<p>count: false</p>
</div>
<div class="section level2">
<h2 id="groups-part-2-2">Groups, part 2<a class="anchor" aria-label="anchor" href="#groups-part-2-2"></a>
</h2>
<p>.panel1-bar-facet2-user[]</p>
<p>.panel2-bar-facet2-user[ <img src="plot_walkthrough_files/figure-html/bar-facet2_user_01_output-1.png" width="700">]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<thead><tr class="header">
<th align="left">count: false</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">count: false</td>
</tr>
<tr class="even">
<td align="left">## Groups, part 2 .panel1-bar-facet2-user[</td>
</tr>
<tr class="odd">
<td align="left">
<code>r food_bars + facet_grid(rows = vars(category), switch = "y", space = "free", scales = "free_y") + theme(strip.placement = "outside") + theme(strip.text.y.left = element_text(angle = 0, hjust = 0, vjust = 1, face = "bold", margin = margin(0.5, 0.4, 0.5, 0.4, "lines")))   #&lt;&lt;</code> ]</td>
</tr>
<tr class="even">
<td align="left">.panel2-bar-facet2-user[ <img src="plot_walkthrough_files/figure-html/bar-facet2_user_03_output-1.png" width="700">]</td>
</tr>
</tbody>
</table>
<p>count: false</p>
</div>
<div class="section level2">
<h2 id="groups-part-2-3">Groups, part 2<a class="anchor" aria-label="anchor" href="#groups-part-2-3"></a>
</h2>
<p>.panel1-bar-facet2-user[]</p>
<p>.panel2-bar-facet2-user[ <img src="plot_walkthrough_files/figure-html/bar-facet2_user_04_output-1.png" width="700">]</p>
<style>
.panel1-bar-facet2-user {
  color: black;
  width: 58.8%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-bar-facet2-user {
  color: black;
  width: 39.2%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-bar-facet2-user {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
</style>
<hr>
<p>I’ll add those facet-related theme elements to another theme. (This is inefficient but I wanted to keep <code>theme_clean</code> for illustration.)</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">theme_facet</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">theme_clean</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>strip.placement <span class="op">=</span> <span class="st">"outside"</span>,
          panel.spacing.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"lines"</span><span class="op">)</span>,
          strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,
          strip.text.y.left <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">0</span>, hjust <span class="op">=</span> <span class="fl">0</span>, vjust <span class="op">=</span> <span class="fl">1</span>, 
                                           margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.4</span>, <span class="st">"lines"</span><span class="op">)</span><span class="op">)</span>,
          strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"gray90"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<hr>
</div>
</div>
<div class="section level1">
<h1 id="offsetting-labels">Offsetting labels<a class="anchor" aria-label="anchor" href="#offsetting-labels"></a>
</h1>
<p>Sometimes multiple related indicators need to be shown together but with very different scales (think a set of bars of high school graduation rates, and a set of bars of suspensions). For this, use <code><a href="../reference/offset_lbls.html">stylehaven::offset_lbls</a></code> to offset labels proportionate to each scale, rather than by a fixed amount.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>chron_subset <span class="ot">&lt;-</span> stylehaven<span class="sc">::</span>chronic_disease <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">category =</span> forcats<span class="sc">::</span><span class="fu">fct_collapse</span>(category, <span class="at">Total =</span> <span class="fu">c</span>(<span class="st">"Connecticut"</span>, <span class="st">"Greater New Haven"</span>)),</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">value =</span> <span class="fu">round</span>(value, <span class="dv">2</span>),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">question =</span> forcats<span class="sc">::</span><span class="fu">fct_relabel</span>(question, camiller<span class="sc">::</span>clean_titles)) <span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(question <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Diabetes"</span>, <span class="st">"Hypertension"</span>), category <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Total"</span>, <span class="st">"Age"</span>, <span class="st">"Race/Ethnicity"</span>))</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(chron_subset)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;246m<span class="co"># A tibble: 6 × 4 [39m</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  question     category group             value</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>   [3m [<span class="dv">38</span>;<span class="dv">5</span>;246m<span class="sc">&lt;</span>fct<span class="sc">&gt;</span> [39m [23m         [3m [<span class="dv">38</span>;<span class="dv">5</span>;246m<span class="sc">&lt;</span>fct<span class="sc">&gt;</span> [39m [23m     [3m [<span class="dv">38</span>;<span class="dv">5</span>;246m<span class="sc">&lt;</span>fct<span class="sc">&gt;</span> [39m [23m              [3m [<span class="dv">38</span>;<span class="dv">5</span>;246m<span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> [39m [23m</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;250m1 [39m Hypertension Total    Connecticut        <span class="fl">0.3</span> </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;250m2 [39m Hypertension Total    Greater New Haven  <span class="fl">0.29</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;250m3 [39m Hypertension Age      Ages <span class="dv">18-34</span>         <span class="fl">0.12</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;250m4 [39m Hypertension Age      Ages <span class="dv">35-49</span>         <span class="fl">0.19</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;250m5 [39m Hypertension Age      Ages <span class="dv">50-64</span>         <span class="fl">0.34</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;250m6 [39m Hypertension Age      Ages <span class="dv">65</span><span class="sc">+</span>           <span class="fl">0.59</span></span></code></pre></div>
<hr>
<p>count: false</p>
<div class="section level2">
<h2 id="different-scales">Different scales<a class="anchor" aria-label="anchor" href="#different-scales"></a>
</h2>
<p>.panel1-bar-offset1-rotate[]</p>
<p>.panel2-bar-offset1-rotate[ <img src="plot_walkthrough_files/figure-html/bar-offset1_rotate_01_output-1.png" width="700">]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<tbody>
<tr class="odd">
<td>count: false</td>
</tr>
<tr class="even">
<td>## Different scales .panel1-bar-offset1-rotate[</td>
</tr>
<tr class="odd">
<td>
<code>r chron_subset %&gt;% ggplot(aes(x = forcats::fct_rev(group), y = value)) + geom_col(width = 0.8, fill = primary) + coord_flip() + scale_y_continuous(expand = expansion(mult = c(0, 0.05)), breaks = NULL) + facet_grid(rows = vars(category), cols = vars(question), scales = "free", space = "free_y", switch = "y") + theme_facet() + labs(x = NULL, y = NULL, subtitle = "Share of adults by Greater New Haven demographic group, 2018", title = "Older adults face heavy burdens of chronic disease", caption = "Source: 2018 DataHaven Community Wellbeing Survey") + geom_text(aes(label = scales::percent(value, 1), y = value - 0.01), hjust = 1, color = "white", fontface = "bold", family = "Barlow Semi Condensed")  #&lt;&lt;</code> ]</td>
</tr>
<tr class="even">
<td>.panel2-bar-offset1-rotate[ <img src="plot_walkthrough_files/figure-html/bar-offset1_rotate_02_output-1.png" width="700">]</td>
</tr>
<tr class="odd">
<td></td>
</tr>
</tbody>
</table>
<p>Offsetting the labels by 1 percentage point made sense for the hypertension data, where the maximum value is around 60%, but not for diabetes, where the max is only about a third of that. If you look closely, the labels for the hypertension bars are almost at the ends of the bars, but the labels for diabetes have a larger gap before the ends of the bars. Small values (e.g. diabetes for ages 18–34) also might get squeezed off.</p>
<hr>
<p>count: false</p>
</div>
<div class="section level2">
<h2 id="offset_lbls">offset_lbls<a class="anchor" aria-label="anchor" href="#offset_lbls"></a>
</h2>
<p>.panel1-bar-offset2-auto[]</p>
<p>.panel2-bar-offset2-auto[]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<thead><tr class="header">
<th align="left">count: false</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">count: false</td>
</tr>
<tr class="even">
<td align="left">## offset_lbls .panel1-bar-offset2-auto[</td>
</tr>
<tr class="odd">
<td align="left">
<code>r chron_subset %&gt;% group_by(question) %&gt;% stylehaven::offset_lbls(value, frac = 0.03, thresh = 0.15, fun = scales::label_percent(accuracy = 1))  #&lt;&lt;</code> ]</td>
</tr>
<tr class="even">
<td align="left">.panel2-bar-offset2-auto[</td>
</tr>
<tr class="odd">
<td align="left">
<code> [38;5;246m# A tibble: 18 × 9 [39m  [38;5;246m# Groups:   question [2] [39m question     category       group   value is_small     off      y  just lbl  [3m [38;5;246m&lt;fct&gt; [39m [23m         [3m [38;5;246m&lt;fct&gt; [39m [23m           [3m [38;5;246m&lt;fct&gt; [39m [23m    [3m [38;5;246m&lt;dbl&gt; [39m [23m  [3m [38;5;246m&lt;lgl&gt; [39m [23m       [3m [38;5;246m&lt;dbl&gt; [39m [23m   [3m [38;5;246m&lt;dbl&gt; [39m [23m  [3m [38;5;246m&lt;dbl&gt; [39m [23m  [3m [38;5;246m&lt;chr&gt; [39m [23m  [38;5;250m 1 [39m Hypertension Total          Connec…  0.3  FALSE    - [31m0 [39m [31m. [39m [31m0 [39m [31m17 [4m7 [24m [39m 0.282      1 30%  [38;5;250m 2 [39m Hypertension Total          Greate…  0.29 FALSE    - [31m0 [39m [31m. [39m [31m0 [39m [31m17 [4m7 [24m [39m 0.272      1 29%  [38;5;250m 3 [39m Hypertension Age            Ages 1…  0.12 FALSE    - [31m0 [39m [31m. [39m [31m0 [39m [31m17 [4m7 [24m [39m 0.102      1 12%  [38;5;250m 4 [39m Hypertension Age            Ages 3…  0.19 FALSE    - [31m0 [39m [31m. [39m [31m0 [39m [31m17 [4m7 [24m [39m 0.172      1 19%  [38;5;250m 5 [39m Hypertension Age            Ages 5…  0.34 FALSE    - [31m0 [39m [31m. [39m [31m0 [39m [31m17 [4m7 [24m [39m 0.322      1 34%  [38;5;250m 6 [39m Hypertension Age            Ages 6…  0.59 FALSE    - [31m0 [39m [31m. [39m [31m0 [39m [31m17 [4m7 [24m [39m 0.572      1 59%  [38;5;250m 7 [39m Hypertension Race/Ethnicity White    0.29 FALSE    - [31m0 [39m [31m. [39m [31m0 [39m [31m17 [4m7 [24m [39m 0.272      1 29%  [38;5;250m 8 [39m Hypertension Race/Ethnicity Black    0.37 FALSE    - [31m0 [39m [31m. [39m [31m0 [39m [31m17 [4m7 [24m [39m 0.352      1 37%  [38;5;250m 9 [39m Hypertension Race/Ethnicity Latino   0.24 FALSE    - [31m0 [39m [31m. [39m [31m0 [39m [31m17 [4m7 [24m [39m 0.222      1 24%  [38;5;250m10 [39m Diabetes     Total          Connec…  0.1  FALSE    - [31m0 [39m [31m. [39m [31m00 [39m [31m6 [4m9 [24m [39m 0.093 [4m1 [24m     1 10%  [38;5;250m11 [39m Diabetes     Total          Greate…  0.09 FALSE    - [31m0 [39m [31m. [39m [31m00 [39m [31m6 [4m9 [24m [39m 0.083 [4m1 [24m     1 9%  [38;5;250m12 [39m Diabetes     Age            Ages 1…  0.02 TRUE      0.010 [4m4 [24m 0.030 [4m4 [24m     0 2%  [38;5;250m13 [39m Diabetes     Age            Ages 3…  0.05 FALSE    - [31m0 [39m [31m. [39m [31m00 [39m [31m6 [4m9 [24m [39m 0.043 [4m1 [24m     1 5%  [38;5;250m14 [39m Diabetes     Age            Ages 5…  0.11 FALSE    - [31m0 [39m [31m. [39m [31m00 [39m [31m6 [4m9 [24m [39m 0.103      1 11%  [38;5;250m15 [39m Diabetes     Age            Ages 6…  0.23 FALSE    - [31m0 [39m [31m. [39m [31m00 [39m [31m6 [4m9 [24m [39m 0.223      1 23%  [38;5;250m16 [39m Diabetes     Race/Ethnicity White    0.09 FALSE    - [31m0 [39m [31m. [39m [31m00 [39m [31m6 [4m9 [24m [39m 0.083 [4m1 [24m     1 9%  [38;5;250m17 [39m Diabetes     Race/Ethnicity Black    0.13 FALSE    - [31m0 [39m [31m. [39m [31m00 [39m [31m6 [4m9 [24m [39m 0.123      1 13%  [38;5;250m18 [39m Diabetes     Race/Ethnicity Latino   0.11 FALSE    - [31m0 [39m [31m. [39m [31m00 [39m [31m6 [4m9 [24m [39m 0.103      1 11%</code> ]</td>
</tr>
<tr class="even">
<td align="left"></td>
</tr>
</tbody>
</table>
<p>count: false</p>
</div>
<div class="section level2">
<h2 id="offset_lbls-1">offset_lbls<a class="anchor" aria-label="anchor" href="#offset_lbls-1"></a>
</h2>
<p>.panel1-bar-offset3-rotate[]</p>
<p>.panel2-bar-offset3-rotate[ <img src="plot_walkthrough_files/figure-html/bar-offset3_rotate_01_output-1.png" width="700">]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<tbody>
<tr class="odd">
<td>count: false</td>
</tr>
<tr class="even">
<td>## offset_lbls .panel1-bar-offset3-rotate[</td>
</tr>
<tr class="odd">
<td>
<code>r chron_subset %&gt;% group_by(question) %&gt;% offset_lbls(value, frac = 0.05, thresh = 0.15, margin = 0.75, fun = scales::label_percent(accuracy = 1)) %&gt;% ggplot(aes(x = forcats::fct_rev(group), y = value)) + geom_col(width = 0.8, fill = primary) + coord_flip() + scale_y_continuous(expand = expansion(mult = c(0, 0.05)), breaks = NULL) + facet_grid(rows = vars(category), cols = vars(question), scales = "free", space = "free_y", switch = "y") + theme_facet() + labs(x = NULL, y = NULL, subtitle = "Share of adults by Greater New Haven demographic group, 2018", title = "Older adults face heavy burdens of chronic disease", caption = "Source: 2018 DataHaven Community Wellbeing Survey") + geom_text(aes(label = lbl, y = y, hjust = just, color = is_small), show.legend = FALSE, fontface = "bold", family = "Barlow Semi Condensed")   #&lt;&lt;</code> ]</td>
</tr>
<tr class="even">
<td>.panel2-bar-offset3-rotate[ <img src="plot_walkthrough_files/figure-html/bar-offset3_rotate_02_output-1.png" width="700">]</td>
</tr>
<tr class="odd">
<td></td>
</tr>
</tbody>
</table>
<p>count: false</p>
</div>
<div class="section level2">
<h2 id="offset_lbls-2">offset_lbls<a class="anchor" aria-label="anchor" href="#offset_lbls-2"></a>
</h2>
<p>.panel1-bar-offset3-user[]</p>
<p>.panel2-bar-offset3-user[ <img src="plot_walkthrough_files/figure-html/bar-offset3_user_01_output-1.png" width="700">]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<tbody>
<tr class="odd">
<td>count: false</td>
</tr>
<tr class="even">
<td>## offset_lbls .panel1-bar-offset3-user[</td>
</tr>
<tr class="odd">
<td>
<code>r chron_subset %&gt;% group_by(question) %&gt;% offset_lbls(value, frac = 0.05, thresh = 0.15, margin = 0.75, fun = scales::label_percent(accuracy = 1)) %&gt;% ggplot(aes(x = forcats::fct_rev(group), y = value)) + geom_col(width = 0.8, fill = primary) + coord_flip() + scale_y_continuous(expand = expansion(mult = c(0, 0.05)), breaks = NULL) + facet_grid(rows = vars(category), cols = vars(question), scales = "free", space = "free_y", switch = "y") + theme_facet() + labs(x = NULL, y = NULL, subtitle = "Share of adults by Greater New Haven demographic group, 2018", title = "Older adults face heavy burdens of chronic disease", caption = "Source: 2018 DataHaven Community Wellbeing Survey") + geom_text(aes(label = lbl, y = y, hjust = just, color = is_small), show.legend = FALSE, fontface = "bold", family = "Barlow Semi Condensed") + scale_color_manual(values = c("TRUE" = "gray20", "FALSE" = "white"))  #&lt;&lt;</code> ]</td>
</tr>
<tr class="even">
<td>.panel2-bar-offset3-user[ <img src="plot_walkthrough_files/figure-html/bar-offset3_user_02_output-1.png" width="700">]</td>
</tr>
<tr class="odd">
<td></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level1">
<h1 id="dodging-labels">Dodging labels<a class="anchor" aria-label="anchor" href="#dodging-labels"></a>
</h1>
<p>A more complicated story to tell with the rent data is how rent compares to income with a subset of towns. For the 2019 Index we calculated the income needed for the median rent to be affordable, based on HUD’s guidance that housing costs shouldn’t be more than 30 percent of a household’s income. Not surprising, most towns have gaps of several thousand dollars between these two numbers. Because they’re on the same scale (income vs income) we can compare them side by side.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rent_income_2br</span> <span class="op">&lt;-</span> <span class="va">rent_2br</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_max</a></span><span class="op">(</span><span class="va">renters</span>, n <span class="op">=</span> <span class="fl">7</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">income</span>, <span class="va">income_needed</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"measure"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link">as_factor</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
           <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html" class="external-link">fct_reorder</a></span><span class="op">(</span><span class="va">annual_rent</span><span class="op">)</span>,
         measure <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link">as_factor</a></span><span class="op">(</span><span class="va">measure</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
           <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_recode.html" class="external-link">fct_recode</a></span><span class="op">(</span>median_income <span class="op">=</span> <span class="st">"income"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
           <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html" class="external-link">fct_rev</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
           <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relabel.html" class="external-link">fct_relabel</a></span><span class="op">(</span><span class="fu">camiller</span><span class="fu">::</span><span class="va"><a href="https://camille-s.github.io/camiller/reference/clean_titles.html" class="external-link">clean_titles</a></span><span class="op">)</span>,
         lbl <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_dollar.html" class="external-link">dollar</a></span><span class="op">(</span><span class="va">value</span>, accuracy <span class="op">=</span> <span class="fl">1</span>, scale <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">1000</span>, suffix <span class="op">=</span> <span class="st">"k"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<hr>
<p>count: false</p>
<div class="section level2">
<h2 id="dodging-labels-1">Dodging labels<a class="anchor" aria-label="anchor" href="#dodging-labels-1"></a>
</h2>
<p>.panel1-dodge1-user[]</p>
<p>.panel2-dodge1-user[ <img src="plot_walkthrough_files/figure-html/dodge1_user_01_output-1.png" width="700">]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<thead><tr class="header">
<th align="left">count: false</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">count: false</td>
</tr>
<tr class="even">
<td align="left">## Dodging labels .panel1-dodge1-user[</td>
</tr>
<tr class="odd">
<td align="left">
<code>r ggplot(rent_income_2br, aes(x = name, y = value, fill = measure, group = measure)) + geom_col(width = 0.8, position = position_dodge2(width = 0.8)) + geom_text(aes(label = lbl, y = value - 1e3), hjust = 1, fontface = "bold", color = "white", family = "Barlow Semi Condensed", position = position_dodge2(width = 0.8)) + coord_flip() + scale_fill_manual(values = seq_pal[c(4, 7)], guide = guide_legend(reverse = TRUE)) + scale_y_continuous(breaks = NULL, expand = expansion(mult = c(0, 0.05))) + theme_clean() + theme(legend.position = "top", legend.box.spacing = unit(0, "lines")) + labs(subtitle = stringr::str_wrap("Annualized median rent for a 2-bedroom housing unit and income needed to afford median rent by town, 2019", 80)) +  #&lt;&lt; labs(x = NULL) +  #&lt;&lt; labs(y = NULL) +  #&lt;&lt; labs(fill = NULL) +  #&lt;&lt; labs(title = "Throughout New Haven County, incomes fall short of affording rent") +  #&lt;&lt; labs(caption = "Source: US Census Bureau 2019 American Community Survey 5-year estimates")  #&lt;&lt;</code> ]</td>
</tr>
<tr class="even">
<td align="left">.panel2-dodge1-user[ <img src="plot_walkthrough_files/figure-html/dodge1_user_03_output-1.png" width="700">]</td>
</tr>
<tr class="odd">
<td align="left"></td>
</tr>
</tbody>
</table>
<p>That’s pretty crowded though. Maybe the story is really the <em>gap</em> more than the two amounts. In that case, a barbell chart (dot + path) could work well.</p>
<p>Also, I’ll use a gray color that comes from that <code>palx</code> set, so it blends well with the blues in the plot.</p>
<hr>
<p>count: false</p>
</div>
<div class="section level2">
<h2 id="dodging-labels-2">Dodging labels<a class="anchor" aria-label="anchor" href="#dodging-labels-2"></a>
</h2>
<p>.panel1-dodge2-user[]</p>
<p>.panel2-dodge2-user[ <img src="plot_walkthrough_files/figure-html/dodge2_user_01_output-1.png" width="700">]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<thead><tr class="header">
<th align="left">count: false</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">count: false</td>
</tr>
<tr class="even">
<td align="left">## Dodging labels .panel1-dodge2-user[</td>
</tr>
<tr class="odd">
<td align="left">
<code>r ggplot(rent_income_2br, aes(x = name, y = value, group = name)) + coord_flip() + geom_path(color = qual_pal[["gray"]], size = 3) + geom_point(aes(color = measure), size = 9, alpha = 0.8) + geom_text(aes(label = lbl), size = 3,  #&lt;&lt; fontface = "bold", color = "white",  #&lt;&lt; family = "Barlow Semi Condensed")   #&lt;&lt;</code> ]</td>
</tr>
<tr class="even">
<td align="left">.panel2-dodge2-user[ <img src="plot_walkthrough_files/figure-html/dodge2_user_03_output-1.png" width="700">]</td>
</tr>
</tbody>
</table>
<p>count: false</p>
</div>
<div class="section level2">
<h2 id="dodging-labels-3">Dodging labels<a class="anchor" aria-label="anchor" href="#dodging-labels-3"></a>
</h2>
<p>.panel1-dodge2-user[]</p>
<p>.panel2-dodge2-user[ <img src="plot_walkthrough_files/figure-html/dodge2_user_04_output-1.png" width="700">]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<thead><tr class="header">
<th align="left">count: false</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">count: false</td>
</tr>
<tr class="even">
<td align="left">## Dodging labels .panel1-dodge2-user[</td>
</tr>
<tr class="odd">
<td align="left">
<code>r ggplot(rent_income_2br, aes(x = name, y = value, group = name)) + coord_flip() + geom_path(color = qual_pal[["gray"]], size = 3) + geom_point(aes(color = measure), size = 9, alpha = 0.8) + geom_text(aes(label = lbl), size = 3, fontface = "bold", color = "white", family = "Barlow Semi Condensed") + scale_color_manual(values = seq_pal[c(4, 7)], guide = guide_legend(reverse = TRUE, override.aes = list(size = 4))) + scale_y_continuous(breaks = NULL, expand = expansion(mult = 0.1)) + theme_clean() + theme(legend.position = "top", legend.box.spacing = unit(0, "lines"))   #&lt;&lt;</code> ]</td>
</tr>
<tr class="even">
<td align="left">.panel2-dodge2-user[ <img src="plot_walkthrough_files/figure-html/dodge2_user_06_output-1.png" width="700">]</td>
</tr>
</tbody>
</table>
<p>count: false</p>
</div>
<div class="section level2">
<h2 id="dodging-labels-4">Dodging labels<a class="anchor" aria-label="anchor" href="#dodging-labels-4"></a>
</h2>
<p>.panel1-dodge2-user[]</p>
<p>.panel2-dodge2-user[ <img src="plot_walkthrough_files/figure-html/dodge2_user_07_output-1.png" width="700">]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<tbody>
<tr class="odd">
<td>count: false</td>
</tr>
<tr class="even">
<td>## Dodging labels .panel1-dodge2-user[</td>
</tr>
<tr class="odd">
<td>
<code>r ggplot(rent_income_2br, aes(x = name, y = value, group = name)) + coord_flip() + geom_path(color = qual_pal[["gray"]], size = 3) + geom_point(aes(color = measure), size = 9, alpha = 0.8) + geom_text(aes(label = lbl), size = 3, fontface = "bold", color = "white", family = "Barlow Semi Condensed") + scale_color_manual(values = seq_pal[c(4, 7)], guide = guide_legend(reverse = TRUE, override.aes = list(size = 4))) + scale_y_continuous(breaks = NULL, expand = expansion(mult = 0.1)) + theme_clean() + theme(legend.position = "top", legend.box.spacing = unit(0, "lines")) + theme(panel.grid.major.y = element_line(color = "gray90", size = 0.8, linetype = "11")) + labs(subtitle = stringr::str_wrap("Annualized median rent for a 2-bedroom housing unit and income needed to afford median rent by town, 2019", 80)) +  #&lt;&lt; labs(x = NULL) +  #&lt;&lt; labs(y = NULL) +  #&lt;&lt; labs(color = NULL) +  #&lt;&lt; labs(title = "Throughout New Haven County, incomes fall short of affording rent") +  #&lt;&lt; labs(caption = "Source: US Census Bureau 2019 American Community Survey 5-year estimates")  #&lt;&lt;</code> ]</td>
</tr>
<tr class="even">
<td>.panel2-dodge2-user[ <img src="plot_walkthrough_files/figure-html/dodge2_user_08_output-1.png" width="700">]</td>
</tr>
<tr class="odd">
<td></td>
</tr>
</tbody>
</table>
<p>One problem is that the values for Wallingford only differ by about $1,000, so the labels overlap. <code><a href="../reference/dodge_lbls.html">stylehaven::dodge_lbls</a></code> returns a data frame of values that are within some threshold of each other in order to draw their labels separately.</p>
<p>This is a little awkward—you have one text layer made with an anti-join (don’t include the squished labels) and one with a semi-join (include only the squished labels)—but it lets you customize how you treat those labels, probably with <code>ggrepel</code>.</p>
<hr>
<p>count: false</p>
</div>
<div class="section level2">
<h2 id="dodging-labels-5">Dodging labels<a class="anchor" aria-label="anchor" href="#dodging-labels-5"></a>
</h2>
<p>.panel1-dodge3-user[]</p>
<p>.panel2-dodge3-user[]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<thead><tr class="header">
<th align="left">count: false</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">count: false</td>
</tr>
<tr class="even">
<td align="left">## Dodging labels .panel1-dodge3-user[</td>
</tr>
<tr class="odd">
<td align="left">```r rent_income_dodge &lt;- rent_income_2br %&gt;% dodge_lbls(x = name, value = value, group = measure, thresh = 1500) rent_income_dodge</td>
</tr>
<tr class="even">
<td align="left">ggplot(rent_income_2br, aes(x = name, y = value, group = name)) + coord_flip() + geom_path(color = qual_pal[[“gray”]], size = 3) + geom_point(aes(color = measure), size = 9, alpha = 0.8) + geom_text(aes(label = lbl), size = 3, fontface = “bold”, color = “white”, family = “Barlow Semi Condensed”, #&lt;&lt; data = . %&gt;% anti_join(rent_income_dodge, by = “name”)) #&lt;&lt; ``` ]</td>
</tr>
<tr class="odd">
<td align="left">.panel2-dodge3-user[</td>
</tr>
<tr class="even">
<td align="left"><code> [38;5;246m# A tibble: 2 × 2 [39m name        measure  [3m [38;5;246m&lt;fct&gt; [39m [23m        [3m [38;5;246m&lt;fct&gt; [39m [23m  [38;5;250m1 [39m Wallingford Median income  [38;5;250m2 [39m Wallingford Income needed</code></td>
</tr>
<tr class="odd">
<td align="left">
<img src="plot_walkthrough_files/figure-html/dodge3_user_03_output-1.png" width="700"> ]</td>
</tr>
</tbody>
</table>
<p>count: false</p>
</div>
<div class="section level2">
<h2 id="dodging-labels-6">Dodging labels<a class="anchor" aria-label="anchor" href="#dodging-labels-6"></a>
</h2>
<p>.panel1-dodge3-user[]</p>
<p>.panel2-dodge3-user[]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<tbody>
<tr class="odd">
<td>count: false</td>
</tr>
<tr class="even">
<td>## Dodging labels .panel1-dodge3-user[</td>
</tr>
<tr class="odd">
<td>```r rent_income_dodge &lt;- rent_income_2br %&gt;% dodge_lbls(x = name, value = value, group = measure, thresh = 1500) rent_income_dodge</td>
</tr>
<tr class="even">
<td>ggplot(rent_income_2br, aes(x = name, y = value, group = name)) + coord_flip() + geom_path(color = qual_pal[[“gray”]], size = 3) + geom_point(aes(color = measure), size = 9, alpha = 0.8) + geom_text(aes(label = lbl), size = 3, fontface = “bold”, color = “white”, family = “Barlow Semi Condensed”, data = . %&gt;% anti_join(rent_income_dodge, by = “name”)) + geom_text_repel(aes(label = lbl, color = measure), size = 3, fontface = “bold”, family = “Barlow Semi Condensed”, direction = “x”, nudge_x = 0.2, seed = 10, force = 10, box.padding = 0.8, data = . %&gt;% semi_join(rent_income_dodge, by = “name”)) + scale_color_manual(values = seq_pal[c(4, 7)], #&lt;&lt; guide = guide_legend(reverse = TRUE, override.aes = list(size = 4))) + #&lt;&lt; scale_y_continuous(breaks = NULL, expand = expansion(mult = 0.1)) + #&lt;&lt; theme_clean() + #&lt;&lt; theme(legend.position = “top”, legend.box.spacing = unit(0, “lines”)) + #&lt;&lt; theme(panel.grid.major.y = element_line(color = “gray90”, size = 0.8, linetype = “11”)) + #&lt;&lt; labs(subtitle = stringr::str_wrap(“Annualized median rent for a 2-bedroom housing unit and income needed to afford median rent by town, 2019”, 80)) + #&lt;&lt; labs(x = NULL) + #&lt;&lt; labs(y = NULL) + #&lt;&lt; labs(color = NULL) + #&lt;&lt; labs(title = “Throughout New Haven County, incomes fall short of affording rent”) + #&lt;&lt; labs(caption = “Source: US Census Bureau 2019 American Community Survey 5-year estimates”) #&lt;&lt; ``` ]</td>
</tr>
<tr class="odd">
<td>.panel2-dodge3-user[</td>
</tr>
<tr class="even">
<td><code> [38;5;246m# A tibble: 2 × 2 [39m name        measure  [3m [38;5;246m&lt;fct&gt; [39m [23m        [3m [38;5;246m&lt;fct&gt; [39m [23m  [38;5;250m1 [39m Wallingford Median income  [38;5;250m2 [39m Wallingford Income needed</code></td>
</tr>
<tr class="odd">
<td>
<img src="plot_walkthrough_files/figure-html/dodge3_user_05_output-1.png" width="700"> ]</td>
</tr>
<tr class="even">
<td></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level1">
<h1 id="down-with-legends">Down with legends<a class="anchor" aria-label="anchor" href="#down-with-legends"></a>
</h1>
<p>Sometimes it’s good to <a href="https://clauswilke.com/dataviz/redundant-coding.html#designing-figures-without-legends" class="external-link">replace legends with direct labels</a> so your reader doesn’t need to track back &amp; forth between the chart and the legend. For this, I’ll use DCWS data on self-rated health with stacked bars. This doesn’t always work—use your judgment for how it balances reduced work with potential clutter.</p>
<hr>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># I want to reverse group levels now for getting both bars &amp; labels in the right order later</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>health <span class="ot">&lt;-</span> stylehaven<span class="sc">::</span>self_rated_health <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">category =</span> forcats<span class="sc">::</span><span class="fu">fct_collapse</span>(category, <span class="at">Total =</span> <span class="fu">c</span>(<span class="st">"Connecticut"</span>, <span class="st">"Greater New Haven"</span>)),</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">c</span>(group, response), forcats<span class="sc">::</span>fct_rev)) <span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Total"</span>, <span class="st">"Income"</span>))</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(health)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;246m<span class="co"># A tibble: 6 × 4 [39m</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  category group             response  value</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>   [3m [<span class="dv">38</span>;<span class="dv">5</span>;246m<span class="sc">&lt;</span>fct<span class="sc">&gt;</span> [39m [23m     [3m [<span class="dv">38</span>;<span class="dv">5</span>;246m<span class="sc">&lt;</span>fct<span class="sc">&gt;</span> [39m [23m              [3m [<span class="dv">38</span>;<span class="dv">5</span>;246m<span class="sc">&lt;</span>fct<span class="sc">&gt;</span> [39m [23m      [3m [<span class="dv">38</span>;<span class="dv">5</span>;246m<span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> [39m [23m</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;250m1 [39m Total    Connecticut       Excellent  <span class="fl">0.23</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;250m2 [39m Total    Connecticut       Very good  <span class="fl">0.36</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;250m3 [39m Total    Connecticut       Good       <span class="fl">0.26</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;250m4 [39m Total    Connecticut       Fair       <span class="fl">0.11</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;250m5 [39m Total    Connecticut       Poor       <span class="fl">0.03</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;250m6 [39m Total    Greater New Haven Excellent  <span class="fl">0.22</span></span></code></pre></div>
<hr>
<p>count: false</p>
<div class="section level2">
<h2 id="removing-legends">Removing legends<a class="anchor" aria-label="anchor" href="#removing-legends"></a>
</h2>
<p>.panel1-bar-legend1-auto[]</p>
<p>.panel2-bar-legend1-auto[]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<thead><tr class="header">
<th align="left">count: false</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">count: false</td>
</tr>
<tr class="even">
<td align="left">## Removing legends .panel1-bar-legend1-auto[</td>
</tr>
<tr class="odd">
<td align="left">```r health_bars &lt;- health %&gt;% ggplot(aes(x = group, y = value, fill = response, group = response)) + geom_col(width = 0.8, position = position_fill()) #&lt;&lt;</td>
</tr>
<tr class="even">
<td align="left">health_bars ``` ]</td>
</tr>
<tr class="odd">
<td align="left">.panel2-bar-legend1-auto[ <img src="plot_walkthrough_files/figure-html/bar-legend1_auto_03_output-1.png" width="700">]</td>
</tr>
</tbody>
</table>
<p>count: false</p>
</div>
<div class="section level2">
<h2 id="removing-legends-1">Removing legends<a class="anchor" aria-label="anchor" href="#removing-legends-1"></a>
</h2>
<p>.panel1-bar-legend1-auto[]</p>
<p>.panel2-bar-legend1-auto[ <img src="plot_walkthrough_files/figure-html/bar-legend1_auto_04_output-1.png" width="700">]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<thead><tr class="header">
<th align="left">count: false</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">count: false</td>
</tr>
<tr class="even">
<td align="left">## Removing legends .panel1-bar-legend1-auto[</td>
</tr>
<tr class="odd">
<td align="left">```r health_bars &lt;- health %&gt;% ggplot(aes(x = group, y = value, fill = response, group = response)) + geom_col(width = 0.8, position = position_fill()) + geom_text(aes(label = scales::percent(value, accuracy = 1)), color = “white”, fontface = “bold”, family = “Barlow Semi Condensed”, position = position_fill(vjust = 0.5)) + coord_flip() + facet_grid(rows = vars(category), scales = “free_y”, space = “free”, switch = “y”) #&lt;&lt;</td>
</tr>
<tr class="even">
<td align="left">health_bars ``` ]</td>
</tr>
<tr class="odd">
<td align="left">.panel2-bar-legend1-auto[ <img src="plot_walkthrough_files/figure-html/bar-legend1_auto_06_output-1.png" width="700">]</td>
</tr>
</tbody>
</table>
<p>count: false</p>
</div>
<div class="section level2">
<h2 id="removing-legends-2">Removing legends<a class="anchor" aria-label="anchor" href="#removing-legends-2"></a>
</h2>
<p>.panel1-bar-legend1-auto[]</p>
<p>.panel2-bar-legend1-auto[ <img src="plot_walkthrough_files/figure-html/bar-legend1_auto_07_output-1.png" width="700">]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<thead><tr class="header">
<th align="left">count: false</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">count: false</td>
</tr>
<tr class="even">
<td align="left">## Removing legends .panel1-bar-legend1-auto[</td>
</tr>
<tr class="odd">
<td align="left">```r health_bars &lt;- health %&gt;% ggplot(aes(x = group, y = value, fill = response, group = response)) + geom_col(width = 0.8, position = position_fill()) + geom_text(aes(label = scales::percent(value, accuracy = 1)), color = “white”, fontface = “bold”, family = “Barlow Semi Condensed”, position = position_fill(vjust = 0.5)) + coord_flip() + facet_grid(rows = vars(category), scales = “free_y”, space = “free”, switch = “y”) + scale_fill_manual(values = seq_pal[3:7]) + scale_x_discrete(labels = scales::label_wrap(10)) + scale_y_barcontinuous(breaks = NULL) #&lt;&lt;</td>
</tr>
<tr class="even">
<td align="left">health_bars ``` ]</td>
</tr>
<tr class="odd">
<td align="left">.panel2-bar-legend1-auto[ <img src="plot_walkthrough_files/figure-html/bar-legend1_auto_09_output-1.png" width="700">]</td>
</tr>
</tbody>
</table>
<p>count: false</p>
</div>
<div class="section level2">
<h2 id="removing-legends-3">Removing legends<a class="anchor" aria-label="anchor" href="#removing-legends-3"></a>
</h2>
<p>.panel1-bar-legend1-auto[]</p>
<p>.panel2-bar-legend1-auto[ <img src="plot_walkthrough_files/figure-html/bar-legend1_auto_10_output-1.png" width="700">]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<thead><tr class="header">
<th align="left">count: false</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">count: false</td>
</tr>
<tr class="even">
<td align="left">## Removing legends .panel1-bar-legend1-auto[</td>
</tr>
<tr class="odd">
<td align="left">```r health_bars &lt;- health %&gt;% ggplot(aes(x = group, y = value, fill = response, group = response)) + geom_col(width = 0.8, position = position_fill()) + geom_text(aes(label = scales::percent(value, accuracy = 1)), color = “white”, fontface = “bold”, family = “Barlow Semi Condensed”, position = position_fill(vjust = 0.5)) + coord_flip() + facet_grid(rows = vars(category), scales = “free_y”, space = “free”, switch = “y”) + scale_fill_manual(values = seq_pal[3:7]) + scale_x_discrete(labels = scales::label_wrap(10)) + scale_y_barcontinuous(breaks = NULL) + labs(x = NULL, y = NULL, fill = NULL, subtitle = “Share of adults by self-rated health by Greater New Haven demographic group, 2018”, title = “Higher-income adults more often rate their health as excellent”) + theme_facet() + theme(legend.position = “bottom”) #&lt;&lt;</td>
</tr>
<tr class="even">
<td align="left">health_bars ``` ]</td>
</tr>
<tr class="odd">
<td align="left">.panel2-bar-legend1-auto[ <img src="plot_walkthrough_files/figure-html/bar-legend1_auto_12_output-1.png" width="700">]</td>
</tr>
</tbody>
</table>
<p>count: false</p>
</div>
<div class="section level2">
<h2 id="removing-legends-4">Removing legends<a class="anchor" aria-label="anchor" href="#removing-legends-4"></a>
</h2>
<p>.panel1-bar-legend1-auto[]</p>
<p>.panel2-bar-legend1-auto[ <img src="plot_walkthrough_files/figure-html/bar-legend1_auto_13_output-1.png" width="700">]</p>
<style>
.panel1-bar-legend1-auto {
  color: black;
  width: 49%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-bar-legend1-auto {
  color: black;
  width: 49%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-bar-legend1-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
</style>
<p>This legend is okay now that the boxes match the direction and order of the bars in the chart, and it wouldn’t be bad to leave it as is. But I’d rather make a subset of data with the values from the top bar (Connecticut) that I can use to label each group directly. I’m going to align the labels with the left ends of bars, except for the one on the right. I’ll also add a numeric variable that I can use for placing labels in the margin of the space normally used for bars.</p>
<hr>
<p>count: false</p>
</div>
<div class="section level2">
<h2 id="labels-legends">Labels &gt; legends<a class="anchor" aria-label="anchor" href="#labels-legends"></a>
</h2>
<p>.panel1-bar-legend2-auto[]</p>
<p>.panel2-bar-legend2-auto[]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<thead><tr class="header">
<th align="left">count: false</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">count: false</td>
</tr>
<tr class="even">
<td align="left">## Labels &gt; legends .panel1-bar-legend2-auto[</td>
</tr>
<tr class="odd">
<td align="left">```r # numeric versions of response levels: excellent = 5, poor = 1 health_lbls &lt;- health %&gt;% slice_max(group) %&gt;% mutate(resp_num = as.numeric(response), #&lt;&lt; y_right = cumsum(value), #&lt;&lt; y_left = cumsum(lag(value, default = 0)), #&lt;&lt; y = ifelse(resp_num == min(resp_num), y_right, y_left), #&lt;&lt; just = ifelse(resp_num == min(resp_num), 1, 0)) #&lt;&lt;</td>
</tr>
<tr class="even">
<td align="left"># numeric versions of response levels: excellent 5, poor = ``` ]</td>
</tr>
<tr class="odd">
<td align="left">.panel2-bar-legend2-auto[</td>
</tr>
<tr class="even">
<td align="left">]</td>
</tr>
</tbody>
</table>
<p>count: false</p>
</div>
<div class="section level2">
<h2 id="labels-legends-1">Labels &gt; legends<a class="anchor" aria-label="anchor" href="#labels-legends-1"></a>
</h2>
<p>.panel1-bar-legend2-auto[]</p>
<p>.panel2-bar-legend2-auto[]</p>
<style>
.panel1-bar-legend2-auto {
  color: black;
  width: 98%;
  hight: 32%;
  float: top;
  padding-left: 1%;
  font-size: 80%
}
.panel2-bar-legend2-auto {
  color: black;
  width: 0%;
  hight: 32%;
  float: top;
  padding-left: 1%;
  font-size: 80%
}
.panel3-bar-legend2-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: top;
  padding-left: 1%;
  font-size: 80%
}
</style>
<p>That’s more verbose than I would normally be for this, but wanted to keep all the intermediary steps for illustration.</p>
<p>For now, ignore the fact that the labels on the smaller bars are kind of squished—I’m working on a function for that too!</p>
<hr>
<p>count: false</p>
</div>
<div class="section level2">
<h2 id="labels-legends-2">Labels &gt; legends<a class="anchor" aria-label="anchor" href="#labels-legends-2"></a>
</h2>
<p>.panel1-bar-legend3-rotate[]</p>
<p>.panel2-bar-legend3-rotate[ <img src="plot_walkthrough_files/figure-html/bar-legend3_rotate_01_output-1.png" width="700">]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<thead><tr class="header">
<th align="left">count: false</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">count: false</td>
</tr>
<tr class="even">
<td align="left">## Labels &gt; legends .panel1-bar-legend3-rotate[</td>
</tr>
<tr class="odd">
<td align="left">
<code>r health_bars + geom_text(aes(hjust = just, y = y, label = response), data = health_lbls)   #&lt;&lt;</code> ]</td>
</tr>
<tr class="even">
<td align="left">.panel2-bar-legend3-rotate[ <img src="plot_walkthrough_files/figure-html/bar-legend3_rotate_03_output-1.png" width="700">]</td>
</tr>
</tbody>
</table>
<p>count: false</p>
</div>
<div class="section level2">
<h2 id="labels-legends-3">Labels &gt; legends<a class="anchor" aria-label="anchor" href="#labels-legends-3"></a>
</h2>
<p>.panel1-bar-legend3-rotate[]</p>
<p>.panel2-bar-legend3-rotate[ <img src="plot_walkthrough_files/figure-html/bar-legend3_rotate_04_output-1.png" width="700">]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<tbody>
<tr class="odd">
<td>count: false</td>
</tr>
<tr class="even">
<td>## Labels &gt; legends .panel1-bar-legend3-rotate[</td>
</tr>
<tr class="odd">
<td>
<code>r health_bars + geom_text(aes(color = response, hjust = just, y = y, label = response), nudge_x = 0.55, data = health_lbls)   #&lt;&lt;</code> ]</td>
</tr>
<tr class="even">
<td>.panel2-bar-legend3-rotate[ <img src="plot_walkthrough_files/figure-html/bar-legend3_rotate_05_output-1.png" width="700">]</td>
</tr>
<tr class="odd">
<td></td>
</tr>
</tbody>
</table>
<p>count: false</p>
</div>
<div class="section level2">
<h2 id="labels-legends-4">Labels &gt; legends<a class="anchor" aria-label="anchor" href="#labels-legends-4"></a>
</h2>
<p>.panel1-bar-legend3-user[]</p>
<p>.panel2-bar-legend3-user[ <img src="plot_walkthrough_files/figure-html/bar-legend3_user_01_output-1.png" width="700">]</p>
<table style="width:6%;" class="table">
<colgroup><col width="5%"></colgroup>
<thead><tr class="header">
<th align="left">count: false</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">count: false</td>
</tr>
<tr class="even">
<td align="left">## Labels &gt; legends .panel1-bar-legend3-user[</td>
</tr>
<tr class="odd">
<td align="left">
<code>r health_bars + geom_text(aes(color = response, hjust = just, y = y, label = response), size = 3, family = "Barlow Semi Condensed", fontface = "bold", nudge_x = 0.55, data = health_lbls) + theme(legend.position = "none") + scale_x_discrete(expand = expansion(add = c(0.25, 0.8)), labels = scales::label_wrap(10))   #&lt;&lt;</code> ]</td>
</tr>
<tr class="even">
<td align="left">.panel2-bar-legend3-user[</td>
</tr>
<tr class="odd">
<td align="left"><code>Scale for 'x' is already present. Adding another scale for 'x', which will replace the existing scale.</code></td>
</tr>
<tr class="even">
<td align="left">
<img src="plot_walkthrough_files/figure-html/bar-legend3_user_03_output-1.png" width="700"> ]</td>
</tr>
</tbody>
</table>
<p>count: false</p>
</div>
<div class="section level2">
<h2 id="labels-legends-5">Labels &gt; legends<a class="anchor" aria-label="anchor" href="#labels-legends-5"></a>
</h2>
<p>.panel1-bar-legend3-user[]</p>
<p>.panel2-bar-legend3-user[]</p>
<style>
.panel1-bar-legend3-user {
  color: black;
  width: 58.8%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-bar-legend3-user {
  color: black;
  width: 39.2%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-bar-legend3-user {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
</style>
<!-- adjust font size in this css code chunk, currently 80 --><style type="text/css">
.remark-code{line-height: 1.5; font-size: 80%}

@media print {
  .has-continuation {
    display: block;
  }
}

code.r.hljs.remark-code{
  position: relative;
}

</style>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Camille Seaberry.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
